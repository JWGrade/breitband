function speedTest(){function t(){}var e={},a=["upload","download"],r={upload:6,download:30},n={upload:[0,1,2,3,4,5,6],download:[0,5,10,15,20,25,30]},l={upload:!1,download:!1},s={upload:"up",download:"down"},d=300,p=300,c=70,o=110,i=Math.PI/180*-70,u=Math.PI/180*251,g=i+Math.PI/2,f=u+Math.PI/2,x={},h={},v=d3.scale.linear().domain([0,360]).range([i,u]),y=d3.svg.arc().innerRadius(c-15).outerRadius(c),w=!1,A,m,b={upload:d3.scale.linear().range([g,f]).domain([0,r.upload]),download:d3.scale.linear().range([g,f]).domain([0,r.download])};return t.init=function(){a.forEach(function(a,r){e[a]=d3.select("#"+a).append("svg").attr("height",d).attr("width",p).attr("viewBox","0 0 "+d+" "+p).attr("preserveAspectRatio","xMinYMin meet").append("g").attr("transform","translate("+d/2+","+p/2+")"),e[a].append("g").append("circle").attr("class","bg").attr("r",o),e[a].append("g").selectAll("line").data(n[a]).enter().append("line").attr("class","ticks").attr("x1",function(e,a){return t.polarX(c-15,i+(u-i)/6*a)}).attr("x2",function(e,a){return t.polarX(o+5,i+(u-i)/6*a)}).attr("y1",function(e,a){return t.polarY(c-15,i+(u-i)/6*a)}).attr("y2",function(e,a){return t.polarY(o+5,i+(u-i)/6*a)}),e[a].append("g").selectAll("text").data(n[a]).enter().append("text").attr("class","speed-label").attr("text-anchor",function(t){return 0===t?"start":"middle"}).attr("dx",function(e,a){return t.polarX(o+15,i+(u-i)/6*a)-(0===e?5:0)}).attr("dy",function(e,a){return t.polarY(o+15,i+(u-i)/6*a)+6}).text(function(t){return t+(0===t?" Mbit/s":"")});for(var l=[],r=1;4>r;r++)l.push(c+(o-c)/4*r);e[a].append("g").selectAll("circle").data(l).enter().append("circle").attr("r",function(t){return t}).attr("class","bg-circle")}),d3.json("./data/data.json",function(s,d){s&&console.log(s),a.forEach(function(a,s){h[a]=d3.scale.linear().domain([0,d3.max(d[a])]).range([c,o]),x[a]=d3.svg.line().x(function(e,r){return t.polarX(h[a](e),v(r))}).y(function(e,r){return t.polarY(h[a](e),v(r))}),e[a].append("g").append("path").attr("class","trend").datum(d[a]).attr("d",x[a]),e[a].append("g").append("circle").attr("class","overlay").attr("r",c),e[a].append("g").append("path").attr("class","top-overlay").attr("d",function(){return d3.svg.arc().innerRadius(c-2).outerRadius(o+2)({startAngle:f,endAngle:2*Math.PI+g})});for(var y=[],s=0;4>s;s+=3)y.push(c+(o-c)/3*s);e[a].append("g").selectAll("circle").data(y).enter().append("circle").attr("r",function(t){return t}).attr("class","bg-circle"),e[a].append("g").selectAll("line").data([i,u]).enter().append("line").attr("class","startend").attr("x1",function(e){return t.polarX(c,e)}).attr("x2",function(e){return t.polarX(o,e)}).attr("y1",function(e){return t.polarY(c,e)}).attr("y2",function(e){return t.polarY(o,e)}),e[a].append("g").selectAll("line").data(n[a]).enter().append("line").attr("class","ticks inner-ticks").attr("x1",function(e,a){return t.polarX(c-15,i+(u-i)/6*a)}).attr("x2",function(e,a){return t.polarX(c,i+(u-i)/6*a)}).attr("y1",function(e,a){return t.polarY(c-15,i+(u-i)/6*a)}).attr("y2",function(e,a){return t.polarY(c,i+(u-i)/6*a)}),e[a].append("text").text("0%").attr("dy",15-c).attr("class","speed-label topscale").attr("text-anchor","middle"),e[a].append("text").text("100%").attr("dy",-o-10).attr("class","speed-label topscale").attr("text-anchor","middle"),e[a].append("line").attr("class","ticks topscale").attr("y1",-c).attr("y2",-o),e[a].append("g").selectAll("line").data(new Array(5)).enter().append("line").attr("class","ticks topscale").attr("x1",-3).attr("x2",3).attr("y1",function(t,e){return-c-e*(o-c)/4}).attr("y2",function(t,e){return-c-e*(o-c)/4}).style("opacity",function(t,e){return 2===e?0:.5}),e[a].append("rect").attr("y",-((o-c)/2+c+5)).attr("x",-10).attr("width",20).attr("height",11).style("fill","#fff"),e[a].append("text").text("50%").attr("dy",5-((o-c)/2+c)).attr("class","speed-label topscale").attr("text-anchor","middle"),e[a].append("text").attr("dy",15).attr("text-anchor","middle").attr("id","spdtst_"+a).attr("class","speed_live").text("0.00"),e[a].append("text").text(a).attr("text-anchor","middle").attr("dy",35).attr("class","speed_type"),e[a].append("text").text("Mbit/s").attr("text-anchor","middle").attr("dy",-25).attr("class","speed_speed"),d[a].forEach(function(t,e){t<d[a][0]/2&&!l[a]&&(l[a]=e)});var w=d[a][l[a]],A=d[a][l[a]-1];l[a]=l[a]-1+(w-A)/(A-d[a][0]/2),e[a].append("g").append("circle").attr("class","avg").attr("r",3).attr("cx",t.polarX(h[a](d[a][0]/2),v(l[a]))).attr("cy",t.polarY(h[a](d[a][0]/2),v(l[a]))),e[a].append("g").append("line").attr("class","avg inneravg").attr("r",3).attr("x1",t.polarX(h[a](d[a][0]/2),v(l[a]))).attr("y1",t.polarY(h[a](d[a][0]/2),v(l[a]))).attr("x2",t.polarX(c-15,v(l[a]))).attr("y2",t.polarY(c-15,v(l[a]))),e[a].append("g").append("line").attr("class","avg").attr("x1",t.polarX(h[a](d[a][0]/2),v(l[a]))).attr("y1",t.polarY(h[a](d[a][0]/2),v(l[a]))).attr("x2",t.polarX(h[a](d[a][0]/2),v(l[a]))).attr("y2",p),d3.select("#"+a).append("div").attr("class","avg-text").html(function(){return"upload"===a?"Durchschnitt Berliner Speed-Test Nutzer*innen: "+(a.charAt(0).toUpperCase()+a.slice(1))+"-Geschwindigkeit <strong>"+(l[a]/360*r[a]).toFixed(2)+"&nbsp;Mbit/s</strong>":'<span class="visible-xs">Durchschnitt Berliner Speed-Test Nutzer*innen: </span>'+(a.charAt(0).toUpperCase()+a.slice(1))+"-Geschwindigkeit <strong>"+(l[a]/360*r[a]).toFixed(2)+"&nbsp;Mbit/s</strong>"})}),d3.select("#spdtst-start").on("click",function(){w||(w=!0,d3.select("#spdtst-start").text("Test lÃ¤uft...").classed("active",!0),a.forEach(function(t){e[t].select(".speed_live").text("0.00").classed("waiting",!0),e[t].select(".live-test").remove();var a=e[t].append("g").attr("class","live-test");a.append("path").datum({newEndAngle:g,newStartAngle:g,startAngle:g,endAngle:g}).attr("d",y)}),A=new NDTPlugin("./js"),A.check()?A.getServer(function(e){A.setServer(e),A.run(),m=setInterval(t.reportStatus,100)},function(t){console.log("error",t)}):console.log("sorry your browser does not support this"))})})},t.reportStatus=function(){var n=A.getStatus();a.forEach(function(a){var l=t.cleanSpeed(n[s[a]],r[a]),d=10>l?l.toFixed(2):l.toFixed(1);l===r[a]&&(d="upload"===a?r[a].toFixed(1)+"+":r[a]+"+ "),e[a].select(".speed_live").text(d),l>0&&e[a].select(".speed_live").classed("waiting",!1),e[a].select(".live-test path").datum(function(t){return t.newStartAngle=g,t.newEndAngle=b[a](l),t}).transition().duration(100).attrTween("d",t.arcTween())}),n.error.match(/completed/)&&(clearInterval(m),w=!1,d3.select("#spdtst-start").html('<span class="image image-speed-red"></span>Erneut testen!').classed("active",!1))},t.polarX=function(t,e){return t*Math.cos(e)},t.polarY=function(t,e){return t*Math.sin(e)},t.cleanSpeed=function(t,e){return t=parseFloat(t),isNaN(t)&&(t=0),0>t&&(t=0),t>e&&(t=e),t},t.arcTween=function(){return function(t){var e=d3.interpolate(t.startAngle,t.newStartAngle),a=d3.interpolate(t.endAngle,t.newEndAngle);return function(r){return t.endAngle=a(r),t.startAngle=e(r),y(t)}}},t}